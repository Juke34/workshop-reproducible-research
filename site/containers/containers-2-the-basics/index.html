<!DOCTYPE html>
<html lang="en">
	<head>
		
		
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<meta name="author" content="Jacques Dainat et al.">
		<link rel="canonical" href="https://Juke34.github.io/workshop-reproducible-research/containers/containers-2-the-basics/">
		<link rel="shortcut icon" href="../../img/favicon.ico">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<title>The basics - Bioinformatics Workshop on Tools for Reproducible Research</title>
		<link href="../../bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="../../css/font-awesome-5.12.2-all.min.css" rel="stylesheet">
		<link href="../../css/base.css" rel="stylesheet">
		<link rel="stylesheet" href="../../css/highlight-github.css">
		<script src="../../bootstrap/dist/js/bootstrap.min.js"></script>
		<script src="../../js/highlight.pack.js"></script>
		
		<script>
			var base_url = '../..';
			var home_url = '../../usage';
			var is_outer_page = false;
			
			var pageToc = [
				{title: "Downloading containers", url: "#_top", children: [
				]},
				{title: "Running containers", url: "#running-containers", children: [
				]},
				{title: "Running interactively", url: "#running-interactively", children: [
				]},
				{title: "Containers inside scripts", url: "#containers-inside-scripts", children: [
				]},
			];

		</script>
		<script src="../../js/base.js"></script> 
	</head>

	<body class="inner-page">
		

		<div class="container-fluid wm-page-content">
			<a name="_top" aria-hidden="true"></a>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../containers-1-introduction/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../containers-1-introduction/" class="btn btn-sm btn-link">
			Introduction
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../containers-3-building-images/" class="btn btn-sm btn-link">
			Building a Docker image
		</a>
		<a href="../containers-3-building-images/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			

			<p>We're almost ready to start, just one last note on nomenclature. You might have
noticed that we sometimes refer to "Docker images" and sometimes to "Docker
containers". A container is simply an instance of an image. To use
a programming metaphor, if an image is a class, then a container is an instance
of that class â€” a runtime object. You can have an image containing, say,
a certain Linux distribution, and then start multiple containers running that
same OS.</p>
<blockquote>
<p><strong>Attention!</strong> <br>
If you don't have root privileges you have to prepend all Docker commands
with <code>sudo</code>.</p>
</blockquote>
<h2 id="downloading-containers">Downloading containers<a class="headerlink" href="#downloading-containers" title="Permanent link">#</a></h2>
<p>Docker containers typically run Linux, so let's start by downloading an image
containing Ubuntu (a popular Linux distribution that is based on only
open-source tools) through the command line.</p>
<pre><code class="language-bash">docker pull ubuntu:latest
</code></pre>
<p>You will notice that it downloads different layers with weird hashes as names.
This represents a very fundamental property of Docker images that we'll get
back to in just a little while. The process should end with something along the
lines of:</p>
<pre><code class="language-no-highlight">Status: Downloaded newer image for ubuntu:latest
docker.io/library/ubuntu:latest
</code></pre>
<p>Let's take a look at our new and growing collection of Docker images:</p>
<pre><code class="language-bash">docker image ls
</code></pre>
<p>The Ubuntu image show show up in this list, with something looking like this:</p>
<pre><code>REPOSITORY       TAG              IMAGE ID            CREATED             SIZE
ubuntu           latest           d70eaf7277ea        3 weeks ago         72.9MB
</code></pre>
<h2 id="running-containers">Running containers<a class="headerlink" href="#running-containers" title="Permanent link">#</a></h2>
<p>We can now start a container running our image. We can refer to the image
either by "REPOSITORY:TAG" ("latest" is the default so we can omit it) or
"IMAGE ID". The syntax for <code>docker run</code> is <code>docker run [OPTIONS] IMAGE
[COMMAND] [ARG...]</code>. Let's run the command <code>uname -a</code> to get some info about
the operating system. First run on your own system (use <code>systeminfo</code> if you are
on Windows):</p>
<pre><code class="language-bash">uname -a
</code></pre>
<p>This should print something like this to your command line:</p>
<pre><code class="language-no-highlight">Darwin liv433l.lan 15.6.0 Darwin Kernel Version 15.6.0: Mon Oct  2 22:20:08 PDT 2017; root:xnu-3248.71.4~1/RELEASE_X86_64 x86_64
</code></pre>
<p>Seems like I'm running the Darwin version of macOS. Then run it in the Ubuntu
Docker container:</p>
<pre><code class="language-bash">docker run ubuntu uname -a
</code></pre>
<p>Here I get the following result:</p>
<pre><code class="language-no-highlight">Linux 24d063b5d877 5.4.39-linuxkit #1 SMP Fri May 8 23:03:06 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
</code></pre>
<p>And now I'm running on Linux! Try the same thing with <code>whoami</code>.</p>
<h2 id="running-interactively">Running interactively<a class="headerlink" href="#running-interactively" title="Permanent link">#</a></h2>
<p>So, seems we can execute arbitrary commands on Linux. Seems useful, but maybe
a bit limited. We can also get an interactive terminal with the flags <code>-it</code>.</p>
<pre><code class="language-bash">docker run -it ubuntu
</code></pre>
<p>This should put at a terminal prompt inside a container running Ubuntu. Your
prompt should now look similar to:</p>
<pre><code class="language-no-highlight">root@1f339e929fa9:/#
</code></pre>
<p>Here you can do whatever; install, run, remove stuff. It will still be within
the container and never affect your host system. Now exit the container with
<code>exit</code>.</p>
<h2 id="containers-inside-scripts">Containers inside scripts<a class="headerlink" href="#containers-inside-scripts" title="Permanent link">#</a></h2>
<p>Okay, so Docker lets us work in any OS in a quite convenient way. That would
probably be useful on its own, but Docker is much more powerful than that. For
example, let's look at the <code>shell</code> part of the <code>index_genome</code> rule in
the Snakemake workflow for the MRSA case study:</p>
<pre><code class="language-python">shell:
    &quot;&quot;&quot;
    bowtie2-build tempfile intermediate/{wildcards.genome_id} &gt; {log}
    &quot;&quot;&quot;
</code></pre>
<p>You may have seen that one can use containers through both Snakemake and
Nextflow if you've gone through their tutorial's extra material, but we can
also use containers directly inside scripts in a very simple way. Let's imagine
we want to run the above command using containers instead. How would that look?
It's quite simple, really: first we find a container image that has <code>bowtie2</code>
installed, and then prepend the command with <code>docker run &lt;image&gt;</code>. </p>
<p>First of all we need to download the genome to index though, so run:</p>
<pre><code class="language-bash">curl -o NCTC8325.fa.gz ftp://ftp.ensemblgenomes.org/pub/bacteria/release-37/fasta/bacteria_18_collection/staphylococcus_aureus_subsp_aureus_nctc_8325/dna//Staphylococcus_aureus_subsp_aureus_nctc_8325.ASM1342v1.dna_rm.toplevel.fa.gz
gunzip -c NCTC8325.fa.gz &gt; tempfile
</code></pre>
<p>to download and prepare the input for bowtie2.</p>
<p>Now try running the following Bash code:</p>
<pre><code class="language-bash">docker run -v $(pwd):/analysis quay.io/biocontainers/bowtie2:2.5.0--py310h8d7afc0_0 bowtie2-build /analysis/tempfile /analysis/NCTC8325
</code></pre>
<p>Docker will automatically download the container image and subsequently run the
command! Here we're using <code>-v $(pwd):/analysis</code> to mount the current directory
inside the container in order to make the <code>tempfile</code> input available to bowtie2.
More on these so called "Bind mounts" in Section 4 of this tutorial.</p>
<blockquote>
<p><strong>Quick recap</strong> <br>
In this section we've learned:</p>
<ul>
<li>How to use <code>docker pull</code> for downloading images from a central registry.</li>
<li>How to use <code>docker image ls</code> for getting information about the images we
  have on our system.</li>
<li>How to use <code>docker run</code> for starting a container from an image.</li>
<li>How to use the <code>-it</code> flag for running in interactive mode.</li>
<li>How to use Docker inside scripts.</li>
</ul>
</blockquote>

			<br>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../containers-1-introduction/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../containers-1-introduction/" class="btn btn-sm btn-link">
			Introduction
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../containers-3-building-images/" class="btn btn-sm btn-link">
			Building a Docker image
		</a>
		<a href="../containers-3-building-images/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			<br>
		</div>

		<footer class="container-fluid wm-page-content text-center small">
			<p>
			<a href="https://github.com/Juke34/workshop-reproducible-research/edit/master/docs/containers/containers-2-the-basics.md" target="_blank">Edit on workshop-reproducible-research</a>
			</p>
			<details>
				<summary>
					Documentation built with <a href="http://www.mkdocs.org/" target="_blank">MkDocs</a> using  <a href="https://github.com/Siphalor/mkdocs-custommill" target="_blank">CustomMill</a>.
				</summary>
				<h6 class="mt-2">Additional Licenses</h6>
				<ul><li>
						CustomMill is based on the <a href="https://github.com/gristlabs/mkdocs-windmill" target="_blank">Windmill</a> theme by Grist Labs, licensed under the <a href="https://github.com/gristlabs/mkdocs-windmill/blob/master/LICENSE" target="_blank">MIT License</a>
					</li>
					<li>
						CustomMill includes <a href="https://getbootstrap.com" target="_blank">Bootstrap</a> version 5.1.3. This is available under the <a href="https://github.com/twbs/bootstrap/blob/master/LICENSE" target="_blank">MIT License</a>.
					</li>
					<li>
						Syntax highlighting is implemented via <a href="https://highlightjs.org" target="_blank">highlight.js</a> licensed under the BSD 3-Clause License and the included github styling made by Vasily Polovnyov.
					</li>
					<li>
						Icons on this site are from <a href="https://fontawesome.com/" target="_blank">Font Awesome</a> which is licensed under the <a href="https://fontawesome.com/license/free" target="_blank">Font Awesome Free License</a>.
					</li></ul>
				<p>Built at 2023-02-10 16:41:13 UTC</p>
			</details>
		</footer>

		
	</body>
</html>