<!DOCTYPE html>
<html lang="en">
	<head>
		
		
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<meta name="author" content="Jacques Dainat et al.">
		<link rel="canonical" href="https://Juke34.github.io/workshop-reproducible-research/containers/containers-4-managing-containers/">
		<link rel="shortcut icon" href="../../img/favicon.ico">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<title>Managing containers - Bioinformatics Workshop on Tools for Reproducible Research</title>
		<link href="../../bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="../../css/font-awesome-5.12.2-all.min.css" rel="stylesheet">
		<link href="../../css/base.css" rel="stylesheet">
		<link rel="stylesheet" href="../../css/highlight-github.css">
		<script src="../../bootstrap/dist/js/bootstrap.min.js"></script>
		<script src="../../js/highlight.pack.js"></script>
		
		<script>
			var base_url = '../..';
			var home_url = '../../usage';
			var is_outer_page = false;
			
			var pageToc = [
				{title: "Bind mounts", url: "#_top", children: [
				]},
			];

		</script>
		<script src="../../js/base.js"></script> 
	</head>

	<body class="inner-page">
		

		<div class="container-fluid wm-page-content">
			<a name="_top" aria-hidden="true"></a>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../containers-3-building-images/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../containers-3-building-images/" class="btn btn-sm btn-link">
			Building a Docker image
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../containers-5-sharing-images/" class="btn btn-sm btn-link">
			Distributing your images
		</a>
		<a href="../containers-5-sharing-images/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			

			<p>When you start a container with <code>docker run</code> it is given an unique id that you
can use for interacting with the container. Let's try to run a container from
the image we just created:</p>
<pre><code class="language-bash">docker run my_docker_conda
</code></pre>
<p>If everything worked <code>run_qc.sh</code> is executed and will first download and then
analyse the three samples. Once it's finished you can list all containers,
including those that have exited.</p>
<pre><code class="language-bash">docker container ls --all
</code></pre>
<p>This should show information about the container that we just ran. Similar to:</p>
<pre><code>CONTAINER ID        IMAGE                    COMMAND                  CREATED             STATUS                      PORTS               NAMES
39548f30ce45        my_docker_conda     &quot;/bin/bash -c 'bas...&quot;    3 minutes ago       Exited (0) 3 minutes ago                             el
</code></pre>
<p>If we run <code>docker run</code> without any flags, your local terminal is attached to the
container. This enables you to see the output of <code>run_qc.sh</code>, but also disables
you from doing anything else in the meantime. We can start a container in
detached mode with the <code>-d</code> flag. Try this out and run <code>docker container ls</code>
to validate that the container is running.</p>
<p>By default, Docker keeps containers after they have exited. This can be
convenient for debugging or if you want to look at logs, but it also consumes
huge amounts of disk space. It's therefore a good idea to always run with
<code>--rm</code>, which will remove the container once it has exited.</p>
<p>If we want to enter a running container, there are two related commands we can
use, <code>docker attach</code> and <code>docker exec</code>. <code>docker attach</code> will attach local
standard input, output, and error streams to a running container. This can be
useful if your terminal closed down for some reason or if you started
a terminal in detached mode and changed your mind. <code>docker exec</code> can be used to
execute any command in a running container. It's typically used to peak in at
what is happening by opening up a new shell. Here we start the container in
detached mode and then start a new interactive shell so that we can see what
happens. If you use <code>ls</code> inside the container you can see how the script
generates file in the <code>data</code>, <code>intermediate</code> and <code>results</code> directories. Note
that you will be thrown out when the container exits, so you have to be quick.</p>
<pre><code class="language-bash">docker run -d --rm --name my_container my_docker_conda
docker exec -it my_container /bin/bash
</code></pre>
<h2 id="bind-mounts">Bind mounts<a class="headerlink" href="#bind-mounts" title="Permanent link">#</a></h2>
<p>There are obviously some advantages to isolating and running your data analysis
in containers, but at some point you need to be able to interact with the host
system to actually deliver the results. This is done via bind mounts. When you
use a bind mount, a file or directory on the <em>host machine</em> is mounted into
a container. That way, when the container generates a file in such a directory
it will appear in the mounted directory on your host system.</p>
<blockquote>
<p><strong>Tip</strong> <br>
Docker also has a more advanced way of data storage called
<a href="https://docs.docker.com/storage/volumes/">volumes</a>. Volumes provide
added flexibility and are independent of the host machine's filesystem
having a specific directory structure available. They are particularly
useful when you want to share data <em>between</em> containers.</p>
</blockquote>
<p>Say that we are interested in getting the resulting html reports from FastQC in
our container. We can do this by mounting a directory called, say,
<code>fastqc_results</code> in your current directory to the <code>/course/results/fastqc</code>
directory in the container. Try this out by running:</p>
<pre><code class="language-bash">docker run --rm -v $(pwd)/fastqc_results:/course/results/fastqc my_docker_conda
</code></pre>
<p>Here the <code>-v</code> flag to docker run specifies the bind mount in the form of
<code>directory/on/your/computer:/directory/inside/container</code>. <code>$(pwd)</code> simply
evaluates to the working directory on your computer.</p>
<p>Once the container finishes validate that it worked by opening one of the html
reports under <code>fastqc_results/</code>.</p>
<p>We can also use bind mounts for getting files into the container rather than
out. We've mainly been discussing Docker in the context of packaging an
analysis pipeline to allow someone else to reproduce its outcome. Another
application is as a kind of very powerful environment manager, similarly to how
we've used Conda before. If you've organized your work into projects, then you
can mount the whole project directory in a container and use the container as
the terminal for running stuff while still using your normal OS for editing
files and so on. Let's try this out by mounting our current directory and start
an interactive terminal. Note that this will override the <code>CMD</code> command, so we
won't start the analysis automatically when we start the container.</p>
<pre><code class="language-bash">docker run -it --rm -v $(pwd):/course/ my_docker_conda /bin/bash
</code></pre>
<p>If you run <code>ls</code> you will see that all the files in the <code>docker</code> directory are
there. Now edit <code>run_qc.sh</code> <strong>on your host system</strong> to download, say, 12000
reads instead of 15000. Then rerun the analysis with <code>bash run_qc.sh</code>. Tada!
Validate that the resulting html reports look fine and then exit the container
with <code>exit</code>.</p>
<blockquote>
<p><strong>Quick recap</strong> <br>
In this section we've learned:</p>
<ul>
<li>How to use <code>docker run</code> for starting a container and how the flags <code>-d</code>
  and <code>--rm</code> work.</li>
<li>How to use <code>docker container ls</code> for displaying information about the
  containers.</li>
<li>How to use <code>docker attach</code> and <code>docker exec</code> to interact with running
  containers.</li>
<li>How to use bind mounts to share data between the container and the host system.</li>
</ul>
</blockquote>

			<br>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../containers-3-building-images/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../containers-3-building-images/" class="btn btn-sm btn-link">
			Building a Docker image
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../containers-5-sharing-images/" class="btn btn-sm btn-link">
			Distributing your images
		</a>
		<a href="../containers-5-sharing-images/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			<br>
		</div>

		<footer class="container-fluid wm-page-content text-center small">
			<p>
			<a href="https://github.com/Juke34/workshop-reproducible-research/edit/master/docs/containers/containers-4-managing-containers.md" target="_blank">Edit on workshop-reproducible-research</a>
			</p>
			<details>
				<summary>
					Documentation built with <a href="http://www.mkdocs.org/" target="_blank">MkDocs</a> using  <a href="https://github.com/Siphalor/mkdocs-custommill" target="_blank">CustomMill</a>.
				</summary>
				<h6 class="mt-2">Additional Licenses</h6>
				<ul><li>
						CustomMill is based on the <a href="https://github.com/gristlabs/mkdocs-windmill" target="_blank">Windmill</a> theme by Grist Labs, licensed under the <a href="https://github.com/gristlabs/mkdocs-windmill/blob/master/LICENSE" target="_blank">MIT License</a>
					</li>
					<li>
						CustomMill includes <a href="https://getbootstrap.com" target="_blank">Bootstrap</a> version 5.1.3. This is available under the <a href="https://github.com/twbs/bootstrap/blob/master/LICENSE" target="_blank">MIT License</a>.
					</li>
					<li>
						Syntax highlighting is implemented via <a href="https://highlightjs.org" target="_blank">highlight.js</a> licensed under the BSD 3-Clause License and the included github styling made by Vasily Polovnyov.
					</li>
					<li>
						Icons on this site are from <a href="https://fontawesome.com/" target="_blank">Font Awesome</a> which is licensed under the <a href="https://fontawesome.com/license/free" target="_blank">Font Awesome Free License</a>.
					</li></ul>
				<p>Built at 2023-02-10 16:41:13 UTC</p>
			</details>
		</footer>

		
	</body>
</html>