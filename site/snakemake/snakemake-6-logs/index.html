<!DOCTYPE html>
<html lang="en">
	<head>
		
		
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<meta name="author" content="Jacques Dainat et al.">
		<link rel="canonical" href="https://Juke34.github.io/workshop-reproducible-research/snakemake/snakemake-6-logs/">
		<link rel="shortcut icon" href="../../img/favicon.ico">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<title>Logs - Bioinformatics Workshop on Tools for Reproducible Research</title>
		<link href="../../bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="../../css/font-awesome-5.12.2-all.min.css" rel="stylesheet">
		<link href="../../css/base.css" rel="stylesheet">
		<link rel="stylesheet" href="../../css/highlight-github.css">
		<script src="../../bootstrap/dist/js/bootstrap.min.js"></script>
		<script src="../../js/highlight.pack.js"></script>
		
		<script>
			var base_url = '../..';
			var home_url = '../../usage';
			var is_outer_page = false;
			
			var pageToc = [
			];

		</script>
		<script src="../../js/base.js"></script> 
	</head>

	<body class="inner-page">
		

		<div class="container-fluid wm-page-content">
			<a name="_top" aria-hidden="true"></a>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../snakemake-5-parameters/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../snakemake-5-parameters/" class="btn btn-sm btn-link">
			Parameters
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../snakemake-7-temporary-files/" class="btn btn-sm btn-link">
			Temporary files
		</a>
		<a href="../snakemake-7-temporary-files/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			

			<p>As you probably noticed it was difficult to follow how the workflow progressed
since some rules printed a lot of output to the terminal. In some cases this
also contained important information, such as statistics on the sequence
alignments or genome indexing. This could be valuable for example if you later
in the project get weird results and want to debug. It's also important from
a reproducibility perspective that the "paper trail" describing how the outputs
were generated is saved. Luckily, Snakemake has a feature that can help with
this. Just as we define <code>input</code> and <code>output</code> in a rule we can also define
<code>log</code>.</p>
<pre><code class="language-python">rule some_rule:
    output:
        &quot;...&quot;
    input:
        &quot;...&quot;
    log:
        &quot;...&quot;
    shell:
        &quot;&quot;&quot;
        echo 'Converting {input} to {output}' &gt; {log}
        &quot;&quot;&quot;
</code></pre>
<p>A log file is not different from any other output file, but it's dealt with
a little differently by Snakemake. For example, it's shown in the file summary
when using <code>-D</code>. It's also a good way to clarify the purpose of the file. We
probably don't need to save logs for all the rules, only the ones with
interesting output.</p>
<ul>
<li><code>get_genome_fasta</code> and <code>get_genome_gff3</code> would be good to log since they are
  dependent on downloading files from an external server.</li>
<li><code>multiqc</code> aggregates quality control data for all the samples into one html
  report, and the log contains information about which samples were aggregated.</li>
<li><code>index_genome</code> outputs some statistics about the genome indexing.</li>
<li><code>align_to_genome</code> outputs important statistics about the alignments. This is
  probably the most important log to save.</li>
</ul>
<p>Now add a log file to some or all of the rules above. A good place to save them
to would be <code>results/logs/rule_name/</code>. In order to avoid that multiple jobs 
write to the same files Snakemake requires that all output and log files contain 
the same wildcards, so be sure to include any wildcards used in the rule in the 
log name as well, <em>e.g.</em> <code>{some_wildcard}.log</code>. </p>
<p>You also have to specify in the <code>shell</code> section of each rule what you want the
log to contain. Some of the programs we use send their log information to
standard out, some to standard error and some let us specify a log file via
a flag. </p>
<p>For example, in the <code>align_to_genome</code> rule, it could look like this (bowtie2 
writes log info to standard error):</p>
<pre><code class="language-python">rule align_to_genome:
    &quot;&quot;&quot;
    Align a fastq file to a genome index using Bowtie 2.
    &quot;&quot;&quot;
    output:
        &quot;intermediate/{sample_id,\w+}.bam&quot;
    input:
        &quot;data/raw_internal/{sample_id}.fastq.gz&quot;,
        &quot;intermediate/NCTC8325.1.bt2&quot;,
        &quot;intermediate/NCTC8325.2.bt2&quot;,
        &quot;intermediate/NCTC8325.3.bt2&quot;,
        &quot;intermediate/NCTC8325.4.bt2&quot;,
        &quot;intermediate/NCTC8325.rev.1.bt2&quot;,
        &quot;intermediate/NCTC8325.rev.2.bt2&quot;
    log:
        &quot;results/logs/align_to_genome/{sample_id}.log&quot;
    shell:
        &quot;&quot;&quot;
        bowtie2 -x intermediate/NCTC8325 -U {input[0]} &gt; {output} 2&gt;{log}
        &quot;&quot;&quot;
</code></pre>
<p>To save some time you can use the info below.</p>
<pre><code class="language-bash"># Wget has a -o flag for specifying the log file
wget remote_file -O output_file -o {log}

# MultiQC writes to standard error so we redirect with &quot;2&gt;&quot;
multiqc -n output_file input_files 2&gt; {log}

# Bowtie2-build redirects to standard out so we use &quot;&gt;&quot;
bowtie2-build input_file index_dir &gt; {log}
</code></pre>
<p>Now rerun the whole workflow. Do the logs contain what they should? Note how 
much easier it is to follow the progression of the workflow when the rules write
to logs instead of to the terminal. </p>
<blockquote>
<p><strong>Tip</strong> <br>
If you have a rule with a shell directive in which several commands are run 
and you want to save stdout and stderr for all commands into the same log file 
you can add <code>exec &amp;&gt;{log}</code> as the first line of the shell directive.</p>
</blockquote>
<p>If you run with <code>-D</code> (or <code>-S</code> for a simpler version) you will see that the 
summary table now also contains the log file for each of the files in the 
workflow.</p>
<blockquote>
<p><strong>Quick recap</strong> <br>
In this section we've learned:</p>
<ul>
<li>How to redirect output to log files with the <code>log</code> directive.</li>
</ul>
</blockquote>

			<br>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../snakemake-5-parameters/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../snakemake-5-parameters/" class="btn btn-sm btn-link">
			Parameters
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../snakemake-7-temporary-files/" class="btn btn-sm btn-link">
			Temporary files
		</a>
		<a href="../snakemake-7-temporary-files/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			<br>
		</div>

		<footer class="container-fluid wm-page-content text-center small">
			<p>
			<a href="https://github.com/Juke34/workshop-reproducible-research/edit/master/docs/snakemake/snakemake-6-logs.md" target="_blank">Edit on workshop-reproducible-research</a>
			</p>
			<details>
				<summary>
					Documentation built with <a href="http://www.mkdocs.org/" target="_blank">MkDocs</a> using  <a href="https://github.com/Siphalor/mkdocs-custommill" target="_blank">CustomMill</a>.
				</summary>
				<h6 class="mt-2">Additional Licenses</h6>
				<ul><li>
						CustomMill is based on the <a href="https://github.com/gristlabs/mkdocs-windmill" target="_blank">Windmill</a> theme by Grist Labs, licensed under the <a href="https://github.com/gristlabs/mkdocs-windmill/blob/master/LICENSE" target="_blank">MIT License</a>
					</li>
					<li>
						CustomMill includes <a href="https://getbootstrap.com" target="_blank">Bootstrap</a> version 5.1.3. This is available under the <a href="https://github.com/twbs/bootstrap/blob/master/LICENSE" target="_blank">MIT License</a>.
					</li>
					<li>
						Syntax highlighting is implemented via <a href="https://highlightjs.org" target="_blank">highlight.js</a> licensed under the BSD 3-Clause License and the included github styling made by Vasily Polovnyov.
					</li>
					<li>
						Icons on this site are from <a href="https://fontawesome.com/" target="_blank">Font Awesome</a> which is licensed under the <a href="https://fontawesome.com/license/free" target="_blank">Font Awesome Free License</a>.
					</li></ul>
				<p>Built at 2023-02-10 16:41:13 UTC</p>
			</details>
		</footer>

		
	</body>
</html>