<!DOCTYPE html>
<html lang="en">
	<head>
		
		
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<meta name="author" content="Jacques Dainat et al.">
		<link rel="canonical" href="https://Juke34.github.io/workshop-reproducible-research/snakemake/snakemake-7-temporary-files/">
		<link rel="shortcut icon" href="../../img/favicon.ico">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<title>Temporary files - Bioinformatics Workshop on Tools for Reproducible Research</title>
		<link href="../../bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="../../css/font-awesome-5.12.2-all.min.css" rel="stylesheet">
		<link href="../../css/base.css" rel="stylesheet">
		<link rel="stylesheet" href="../../css/highlight-github.css">
		<script src="../../bootstrap/dist/js/bootstrap.min.js"></script>
		<script src="../../js/highlight.pack.js"></script>
		
		<script>
			var base_url = '../..';
			var home_url = '../../usage';
			var is_outer_page = false;
			
			var pageToc = [
			];

		</script>
		<script src="../../js/base.js"></script> 
	</head>

	<body class="inner-page">
		

		<div class="container-fluid wm-page-content">
			<a name="_top" aria-hidden="true"></a>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../snakemake-6-logs/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../snakemake-6-logs/" class="btn btn-sm btn-link">
			Logs
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../snakemake-8-targets/" class="btn btn-sm btn-link">
			Targets
		</a>
		<a href="../snakemake-8-targets/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			

			<p>It's not uncommon that workflows contain temporary files that should be kept
for some time and then deleted once they are no longer needed. A typical case
could be that some operation generates a file, which is then compressed to save
space or indexed to make searching faster. There is then no need to save the
original output file. Take a look at the job graph for our workflow again. The
output from <code>align_to_genome</code> is a bam file, which contains information about
all the reads for a sample and where they map in the genome. For downstream
processing we need this file to be sorted by genome coordinates. This is what
the rule <code>sort_bam</code> is for. We therefore end up with both
<code>intermediate/{sample_id}.bam</code> and <code>intermediate/{sample_id}.sorted.bam</code>.</p>
<p>In Snakemake we can mark an output file as temporary like this:</p>
<pre><code class="language-python">output: temp(&quot;...&quot;)
</code></pre>
<p>The file will then be deleted as soon as all jobs where it's an input have
finished. Now do this for the output of <code>align_to_genome</code>. We have to rerun the
rule for it to trigger, so use <code>-R align_to_genome</code>. It should look something
like this:</p>
<pre><code class="language-no-highlight">.
.
rule sort_bam:
    input: intermediate/SRR935090.bam
    output: intermediate/SRR935090.sorted.bam
    jobid: 2
    wildcards: sample_id=SRR935090

Removing temporary output file intermediate/SRR935090.bam.
Finished job 2.
.
.
</code></pre>
<blockquote>
<p><strong>Tip</strong> <br>
Sometimes you may want to trigger removal of temporary files without
actually rerunning the jobs. You can then use the <code>--delete-temp-output</code>
flag. In some cases you may instead want to run only parts of a workflow
and therefore want to prevent files marked as temporary from being deleted
(because the files are needed for other parts of the workflow). In such
cases you can use the <code>--notemp</code> flag.</p>
</blockquote>
<p>Snakemake has a number of options for marking files:</p>
<ul>
<li><code>temp("...")</code>: The output file should be deleted once it's no longer needed
  by any rules.</li>
<li><code>protected("...")</code>: The output file should be write-protected. Typically used
  to protect files that require a huge amount of computational resources from
  being accidentally deleted.</li>
<li><code>ancient("...")</code>: The timestamp of the input file is ignored and it's always
  assumed to be older than any of the output files.</li>
<li><code>touch("...")</code>: The output file should be "touched", <em>i.e.</em> created or
  updated, when the rule has finished. Typically used as "flag files" to
  enforce some rule execution order without real file dependencies.</li>
<li><code>directory("...")</code>: The output is a directory rather than a file.</li>
</ul>
<blockquote>
<p><strong>Quick recap</strong> <br>
In this section we've learned:</p>
<ul>
<li>How to mark an output file as temporary for automatic removal.</li>
</ul>
</blockquote>

			<br>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../snakemake-6-logs/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../snakemake-6-logs/" class="btn btn-sm btn-link">
			Logs
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../snakemake-8-targets/" class="btn btn-sm btn-link">
			Targets
		</a>
		<a href="../snakemake-8-targets/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			<br>
		</div>

		<footer class="container-fluid wm-page-content text-center small">
			<p>
			<a href="https://github.com/Juke34/workshop-reproducible-research/edit/master/docs/snakemake/snakemake-7-temporary-files.md" target="_blank">Edit on workshop-reproducible-research</a>
			</p>
			<details>
				<summary>
					Documentation built with <a href="http://www.mkdocs.org/" target="_blank">MkDocs</a> using  <a href="https://github.com/Siphalor/mkdocs-custommill" target="_blank">CustomMill</a>.
				</summary>
				<h6 class="mt-2">Additional Licenses</h6>
				<ul><li>
						CustomMill is based on the <a href="https://github.com/gristlabs/mkdocs-windmill" target="_blank">Windmill</a> theme by Grist Labs, licensed under the <a href="https://github.com/gristlabs/mkdocs-windmill/blob/master/LICENSE" target="_blank">MIT License</a>
					</li>
					<li>
						CustomMill includes <a href="https://getbootstrap.com" target="_blank">Bootstrap</a> version 5.1.3. This is available under the <a href="https://github.com/twbs/bootstrap/blob/master/LICENSE" target="_blank">MIT License</a>.
					</li>
					<li>
						Syntax highlighting is implemented via <a href="https://highlightjs.org" target="_blank">highlight.js</a> licensed under the BSD 3-Clause License and the included github styling made by Vasily Polovnyov.
					</li>
					<li>
						Icons on this site are from <a href="https://fontawesome.com/" target="_blank">Font Awesome</a> which is licensed under the <a href="https://fontawesome.com/license/free" target="_blank">Font Awesome Free License</a>.
					</li></ul>
				<p>Built at 2023-02-10 16:41:13 UTC</p>
			</details>
		</footer>

		
	</body>
</html>