<!DOCTYPE html>
<html lang="en">
	<head>
		
		
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<meta name="author" content="Jacques Dainat et al.">
		<link rel="canonical" href="https://Juke34.github.io/workshop-reproducible-research/snakemake/snakemake-8-targets/">
		<link rel="shortcut icon" href="../../img/favicon.ico">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<title>Targets - Bioinformatics Workshop on Tools for Reproducible Research</title>
		<link href="../../bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="../../css/font-awesome-5.12.2-all.min.css" rel="stylesheet">
		<link href="../../css/base.css" rel="stylesheet">
		<link rel="stylesheet" href="../../css/highlight-github.css">
		<script src="../../bootstrap/dist/js/bootstrap.min.js"></script>
		<script src="../../js/highlight.pack.js"></script>
		
		<script>
			var base_url = '../..';
			var home_url = '../../usage';
			var is_outer_page = false;
			
			var pageToc = [
			];

		</script>
		<script src="../../js/base.js"></script> 
	</head>

	<body class="inner-page">
		

		<div class="container-fluid wm-page-content">
			<a name="_top" aria-hidden="true"></a>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../snakemake-7-temporary-files/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../snakemake-7-temporary-files/" class="btn btn-sm btn-link">
			Temporary files
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../snakemake-9-shadow-rules/" class="btn btn-sm btn-link">
			Shadow rules
		</a>
		<a href="../snakemake-9-shadow-rules/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			

			<p>So far we have only defined the inputs/outputs of a rule as strings, or in
some case a list of strings, but Snakemake allows us to be much more flexible
than that. Actually, we can use any Python expression or even functions, as
long as they return a string or list of strings. Consider the rule
<code>align_to_genome</code> below.</p>
<pre><code class="language-python">rule align_to_genome:
    &quot;&quot;&quot;
    Align a fastq file to a genome index using Bowtie 2.
    &quot;&quot;&quot;
    output:
        &quot;intermediate/{sample_id,\w+}.bam&quot;
    input:
        &quot;data/raw_internal/{sample_id}.fastq.gz&quot;,
        &quot;intermediate/NCTC8325.1.bt2&quot;,
        &quot;intermediate/NCTC8325.2.bt2&quot;,
        &quot;intermediate/NCTC8325.3.bt2&quot;,
        &quot;intermediate/NCTC8325.4.bt2&quot;,
        &quot;intermediate/NCTC8325.rev.1.bt2&quot;,
        &quot;intermediate/NCTC8325.rev.2.bt2&quot;
    shell:
        &quot;&quot;&quot;
        bowtie2 -x intermediate/NCTC8325 -U {input[0]} &gt; {output}
        &quot;&quot;&quot;
</code></pre>
<p>Here we have seven inputs; the fastq file with the reads and six files with
similar file names from the Bowtie 2 genome indexing. We can try to tidy this
up by using a Python expression to generate a list of these files instead. If
you're familiar with Python you could do this with 
<a href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions">list comprehensions</a>
like this:</p>
<pre><code class="language-python">input:
    fastq = &quot;data/raw_internal/{sample_id}.fastq.gz&quot;,
    index = [f&quot;intermediate/NCTC8325.{substr}.bt2&quot; for
        substr in [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;rev.1&quot;, &quot;rev.2&quot;]]
</code></pre>
<p>This will take the elements of the list of substrings one by one, and insert
that element in the place of <code>{substr}</code>. Since this type of aggregating
rules are quite common, Snakemake also has a more compact way of achieving the
same thing.</p>
<pre><code class="language-python">input:
    fastq = &quot;data/raw_internal/{sample_id}.fastq.gz&quot;,
    index = expand(&quot;intermediate/NCTC8325.{substr}.bt2&quot;,
           substr = [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;rev.1&quot;, &quot;rev.2&quot;])
</code></pre>
<p>Now change in the rules <code>index_genome</code> and <code>align_to_genome</code> to use the
<code>expand()</code> expression.</p>
<p>In the workflow we decide which samples to run by including the SRR ids in the
names of the inputs to the rules <code>multiqc</code> and <code>generate_count_table</code>. This is
a potential source of errors since it's easy to change in one place and forget
to change in the other. As we've mentioned before, but not really used so far,
Snakemake allows us to use Python code "everywhere". Let's therefore define
a list of sample ids and put at the very top of the Snakefile, just before the
rule <code>all</code>.</p>
<pre><code class="language-python">SAMPLES = [&quot;SRR935090&quot;, &quot;SRR935091&quot;, &quot;SRR935092&quot;]
</code></pre>
<p>Now use <code>expand()</code> in <code>multiqc</code> and <code>generate_count_table</code> to use <code>SAMPLES</code> for
the sample ids. For the <code>multiqc</code> rule it could look like this:</p>
<pre><code class="language-python">input:
    expand(&quot;intermediate/{sample_id}_fastqc.zip&quot;, sample_id = SAMPLES)
</code></pre>
<p>See if you can update the <code>generate_count_table</code> rule in the same manner!</p>
<blockquote>
<p><strong>Quick recap</strong> <br>
In this section we've learned:</p>
<ul>
<li>How to use the <code>expand()</code> expression to create a list with file names, 
  inserting all provided wildcard values.</li>
</ul>
</blockquote>

			<br>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../snakemake-7-temporary-files/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../snakemake-7-temporary-files/" class="btn btn-sm btn-link">
			Temporary files
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../snakemake-9-shadow-rules/" class="btn btn-sm btn-link">
			Shadow rules
		</a>
		<a href="../snakemake-9-shadow-rules/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			<br>
		</div>

		<footer class="container-fluid wm-page-content text-center small">
			<p>
			<a href="https://github.com/Juke34/workshop-reproducible-research/edit/master/docs/snakemake/snakemake-8-targets.md" target="_blank">Edit on workshop-reproducible-research</a>
			</p>
			<details>
				<summary>
					Documentation built with <a href="http://www.mkdocs.org/" target="_blank">MkDocs</a> using  <a href="https://github.com/Siphalor/mkdocs-custommill" target="_blank">CustomMill</a>.
				</summary>
				<h6 class="mt-2">Additional Licenses</h6>
				<ul><li>
						CustomMill is based on the <a href="https://github.com/gristlabs/mkdocs-windmill" target="_blank">Windmill</a> theme by Grist Labs, licensed under the <a href="https://github.com/gristlabs/mkdocs-windmill/blob/master/LICENSE" target="_blank">MIT License</a>
					</li>
					<li>
						CustomMill includes <a href="https://getbootstrap.com" target="_blank">Bootstrap</a> version 5.1.3. This is available under the <a href="https://github.com/twbs/bootstrap/blob/master/LICENSE" target="_blank">MIT License</a>.
					</li>
					<li>
						Syntax highlighting is implemented via <a href="https://highlightjs.org" target="_blank">highlight.js</a> licensed under the BSD 3-Clause License and the included github styling made by Vasily Polovnyov.
					</li>
					<li>
						Icons on this site are from <a href="https://fontawesome.com/" target="_blank">Font Awesome</a> which is licensed under the <a href="https://fontawesome.com/license/free" target="_blank">Font Awesome Free License</a>.
					</li></ul>
				<p>Built at 2023-02-10 16:41:13 UTC</p>
			</details>
		</footer>

		
	</body>
</html>