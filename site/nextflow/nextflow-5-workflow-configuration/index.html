<!DOCTYPE html>
<html lang="en">
	<head>
		
		
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<meta name="author" content="Jacques Dainat et al.">
		<link rel="canonical" href="https://Juke34.github.io/workshop-reproducible-research/nextflow/nextflow-5-workflow-configuration/">
		<link rel="shortcut icon" href="../../img/favicon.ico">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<title>Configuration - Bioinformatics Workshop on Tools for Reproducible Research</title>
		<link href="../../bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="../../css/font-awesome-5.12.2-all.min.css" rel="stylesheet">
		<link href="../../css/base.css" rel="stylesheet">
		<link rel="stylesheet" href="../../css/highlight-github.css">
		<script src="../../bootstrap/dist/js/bootstrap.min.js"></script>
		<script src="../../js/highlight.pack.js"></script>
		
		<script>
			var base_url = '../..';
			var home_url = '../../usage';
			var is_outer_page = false;
			
			var pageToc = [
				{title: "Configuration basics", url: "#_top", children: [
				]},
				{title: "Command line parameters", url: "#command-line-parameters", children: [
				]},
				{title: "Configuring inputs", url: "#configuring-inputs", children: [
				]},
				{title: "Other configuration scopes", url: "#other-configuration-scopes", children: [
				]},
			];

		</script>
		<script src="../../js/base.js"></script> 
	</head>

	<body class="inner-page">
		

		<div class="container-fluid wm-page-content">
			<a name="_top" aria-hidden="true"></a>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../nextflow-4-working-with-processes/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../nextflow-4-working-with-processes/" class="btn btn-sm btn-link">
			Processes
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../nextflow-6-optimising-the-mrsa-workflow/" class="btn btn-sm btn-link">
			The MRSA Workflow
		</a>
		<a href="../nextflow-6-optimising-the-mrsa-workflow/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			

			<p>We've so far been working with a relatively non-generalised workflow: it's got
hard-coded inputs, paths and genome references. This is perfectly fine for a
project that is purely aimed at getting reproducible results (which is the full
extent of what you want in a lot of cases), but it can be made a lot more
generalisable. Let's go through the MRSA workflow and see what can be improved!</p>
<h1 id="configuration-basics">Configuration basics<a class="headerlink" href="#configuration-basics" title="Permanent link">#</a></h1>
<p>One of the things that allow generalisability of Nextflow workflows is
<em>parameters</em>, which hold information and values that can be changed directly on
the command-line at the time of execution. One use of parameters in our MRSA
workflow is to remove the hard-coded <code>results</code> output directory, for example.
Parameters can be written in the following form:</p>
<pre><code class="language-nextflow">params {
    parameter_1 = &quot;some/data/path&quot;      // A string parameter
    parameter_2 = 42                    // A value parameter
    parameter_3 = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]  // A list parameter
}
</code></pre>
<p>You would then refer to these parameters using <em>e.g.</em> <code>params.parameter_1</code>
anywhere you need to in the workflow. Although parameters can be defined in
<code>main_mrsa.nf</code>, it is preferable to define them in a separate <em>configuration file</em>. The default name
of this file is <code>nextflow.config</code> and if such a file is present it will be used
automatically by Nextflow (to supply a config file with another name use
<code>nextflow -c &lt;path-to-config-file&gt; run main_mrsa.nf</code>)</p>
<ul>
<li>
<p>Create a configuration file and add a parameter for the <code>results</code> output
  directory.</p>
</li>
<li>
<p>Use your newly created parameter in the <code>publishDir</code> directory of a process
  (it'll be in the form of <code>${params.resultsdir}/some/other/path</code>, for example).
  Run your workflow to see if it worked.</p>
</li>
</ul>
<blockquote>
<p><strong>Tip</strong> <br>
Instead of manually changing all the hard-coded directories in your
workflow you can use the following little <code>sed</code> command, which will do it for
you: <code>sed 's/\"results\//\"${params.resultsdir}\//g' main_mrsa.nf &gt; tmp; mv
tmp main_mrsa.nf</code>. In case you used a parameter name other than <code>resultsdir</code>
update the command accordingly.</p>
</blockquote>
<h1 id="command-line-parameters">Command line parameters<a class="headerlink" href="#command-line-parameters" title="Permanent link">#</a></h1>
<p>Workflow parameters can be assigned on the command-line by executing workflows like 
so: <code>nextflow run main_mrsa.nf --parameter_name 'some_value'</code>. The workflow parameter <code>parameter_name</code>,
is prefixed by a double dash <code>--</code> to tell Nextflow this is a parameter to the workflow (a single dash
is a parameter to Nextflow, e.g. <code>-resume</code>). The value is also quoted (this is important for parameters
that take file paths as values).</p>
<ul>
<li>Run your workflow using the parameter you previously created, but pick
  something other than the default value!</li>
</ul>
<p>You should now have a new directory containing all the results! This is highly
useful if you want to keep track of separate runs of a workflow with different
software parameters, for example: <code>nextflow run main.nf --important_param 'value1'
--resultsdir 'value1'</code>, or simply want to keep the results of separate versions of
the same workflow. You can also change parameters by using the <code>-params-file</code> option
or by using another configuration file (and using <code>-c</code>), rather than on the command line!</p>
<h1 id="configuring-inputs">Configuring inputs<a class="headerlink" href="#configuring-inputs" title="Permanent link">#</a></h1>
<p>Remember the input for the MRSA workflow, the <code>ch_sra_ids</code> channel? This input
is also hard-coded inside the <code>main_mrsa.nf</code> file. This could also be made into
a parameter!</p>
<ul>
<li>Add another parameter for the input SRA IDs and execute your workflow to check
  that it worked.</li>
</ul>
<p>Using lists for parameters has its problems though, as you won't be able to
change it on the command line, since the command line doesn't know about Groovy
lists. There are several other ways of specifying inputs in a command
line-friendly way, one of which is to use <em>sample sheets</em>. Instead of
specifying samples directly in the command line, you specify a file that lists
the input samples instead; this is the standard that is used in <em>e.g.</em> <a href="https://nf-co.re/">nf-core
pipelines</a>. Such a sample sheet for the MRSA workflow might
be stored in <em>e.g.</em> <code>input.csv</code> and look like this:</p>
<pre><code class="language-no-highlight">sra_id
SRR935090
SRR935091
SRR935092
</code></pre>
<p>Reading input from a CSV file can be done by combining the <code>.splitCsv</code> channel
factory (splitting the rows to read each entry) and the <code>.map</code> operator
(defining which columns should be used). Let's see if we can make it work!</p>
<ul>
<li>
<p>Create the <code>input.csv</code> file with the above shown content.</p>
</li>
<li>
<p>Change the definition of the <code>ch_sra_ids</code> channel to take the value of a new
  parameter of your choice, defined in the configuration file.</p>
</li>
<li>
<p>Add the <code>.splitCsv(header: true)</code> operator to the end of the channel
  definition, so that the input is read from the file contents.</p>
</li>
<li>
<p>Add the <code>.map{row -&gt; row.sra_id}</code> operator, which specifies that each row
  should contain the <code>sra_id</code> column, but no other columns.</p>
</li>
</ul>
<p>You should now have a more generalised input to your workflow! Try to run it to
make sure it works - look below if you need some help.</p>
<details>
<summary> Click to show </summary>


<pre><code class="language-nextflow">// Channel definition
ch_sra_ids = Channel
    .fromPath ( params.sra_ids )
    .splitCsv ( header: true )
    .map      { row -&gt; row.sra_id }

// Configuration file
sra_ids = &quot;input.csv&quot;
</code></pre>


</details>

<p>By specifying inputs from sample sheets like this we can change inputs
of a workflow execution by creating another sample sheet and specifying
<em>e.g.</em>, <code>--sra_ids input-2.csv</code> on the command line. This is highly useful when
you want to run a single sample <em>e.g.</em>, when testing a workflow, or when you
want to keep track of all the different inputs you've used historically. Sample
sheets are also useful for keeping other metadata, such as custom sample names,
sample groups, location of files, <em>etc.</em> For example:</p>
<pre><code class="language-no-hightlight">sample-1,case,data/sample-1.fastq.gz
sample-2,ctrl,data/sample-2.fastq.gz
sample-3,case,data/sample-3.fastq.gz
sample-4,ctrl,data/sample-4.fastq.gz
</code></pre>
<p>Here we have not only names and file paths but also to which group each sample
belongs, <em>i.e.</em> case or control. Such metadata can be highly useful for more
advanced workflows to use in downstream analyses, such as differential gene
expression! We could create a tuple based on this metadata like so:</p>
<pre><code class="language-nextflow">ch_input = Channel
    .fromPath(&quot;metadata.csv&quot;)
    .splitCsv(header: ['id', 'group', 'fastq'])
    .view()
</code></pre>
<blockquote>
<p><strong>Input file formatting</strong> <br>
The input file may also have headers, in which case you can use <code>header:
true</code> to use the column headers defined in the file. You can also read <em>e.g.</em>
tab-separated files by using the <code>sep</code> field: <code>.splitCsv(sep: "\t")</code>.</p>
</blockquote>
<h1 id="other-configuration-scopes">Other configuration scopes<a class="headerlink" href="#other-configuration-scopes" title="Permanent link">#</a></h1>
<p>There are lots of things that you might want to add to your configuration, not
just parameters! The workflow <em>manifest</em>, for example, which might look like
this:</p>
<pre><code class="language-nextflow">manifest {
    name        = &quot;My Workflow&quot;
    description = &quot;My workflow, created by me&quot;
    author      = &quot;Me&quot;
    mainScript  = &quot;main.nf&quot;
    version     = &quot;1.0.0&quot;
}
</code></pre>
<ul>
<li>Go ahead and add a workflow manifest to your <code>nextflow.config</code> file!</li>
</ul>
<p>The manifest is useful when you're publishing or sharing the workflow through
<em>e.g.</em> GitHub or similar. There are many more such configuration <em>scopes</em> that
you might want to use - read more about them <a href="https://www.nextflow.io/docs/latest/config.html#config-scopes">in the documentation</a>.</p>
<blockquote>
<p><strong>Quick recap</strong> <br>
In this section we learnt:</p>
<ul>
<li>How to create parameters in a configuration file</li>
<li>How to specify parameters on the command line</li>
<li>How to add workflow manifest and other configuration scopes</li>
</ul>
</blockquote>

			<br>
			






<div class="row pt-2 pb-4">
	<div class="col-sm text-center text-sm-left">
		<a href="../nextflow-4-working-with-processes/" class="btn btn-sm btn-outline-dark">
			<i class="fa fa-chevron-left" aria-hidden="true"></i>
			Previous
		</a>
		<a href="../nextflow-4-working-with-processes/" class="btn btn-sm btn-link">
			Processes
		</a>
	</div>
	

	
	<div class="col-sm text-center text-sm-right">
		<a href="../nextflow-6-optimising-the-mrsa-workflow/" class="btn btn-sm btn-link">
			The MRSA Workflow
		</a>
		<a href="../nextflow-6-optimising-the-mrsa-workflow/" class="btn btn-sm btn-outline-dark">
			Next
			<i class="fa fa-chevron-right" aria-hidden="true"></i>
		</a>
	</div>
	
</div>

			<br>
		</div>

		<footer class="container-fluid wm-page-content text-center small">
			<p>
			<a href="https://github.com/Juke34/workshop-reproducible-research/edit/master/docs/nextflow/nextflow-5-workflow-configuration.md" target="_blank">Edit on workshop-reproducible-research</a>
			</p>
			<details>
				<summary>
					Documentation built with <a href="http://www.mkdocs.org/" target="_blank">MkDocs</a> using  <a href="https://github.com/Siphalor/mkdocs-custommill" target="_blank">CustomMill</a>.
				</summary>
				<h6 class="mt-2">Additional Licenses</h6>
				<ul><li>
						CustomMill is based on the <a href="https://github.com/gristlabs/mkdocs-windmill" target="_blank">Windmill</a> theme by Grist Labs, licensed under the <a href="https://github.com/gristlabs/mkdocs-windmill/blob/master/LICENSE" target="_blank">MIT License</a>
					</li>
					<li>
						CustomMill includes <a href="https://getbootstrap.com" target="_blank">Bootstrap</a> version 5.1.3. This is available under the <a href="https://github.com/twbs/bootstrap/blob/master/LICENSE" target="_blank">MIT License</a>.
					</li>
					<li>
						Syntax highlighting is implemented via <a href="https://highlightjs.org" target="_blank">highlight.js</a> licensed under the BSD 3-Clause License and the included github styling made by Vasily Polovnyov.
					</li>
					<li>
						Icons on this site are from <a href="https://fontawesome.com/" target="_blank">Font Awesome</a> which is licensed under the <a href="https://fontawesome.com/license/free" target="_blank">Font Awesome Free License</a>.
					</li></ul>
				<p>Built at 2023-02-10 16:41:13 UTC</p>
			</details>
		</footer>

		
	</body>
</html>